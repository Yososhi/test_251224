# セキュリティレビューレポート

**レビュー日**: 2025年1月現在  
**対象**: 18days-work-manager プロジェクト  
**ステータス**: 本番環境に反映済み

---

## 🔴 重大な問題（潜在的なリスク）

### 1. APIキーがクライアント側バンドルに含まれる設定（未使用だが危険）

**ファイル**: `vite.config.ts` (14-15行目)

**問題**:
```typescript
define: {
  'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
  'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
}
```

Viteの`define`オプションは、環境変数の値をビルド時にJavaScriptコードに直接埋め込みます。これにより、APIキーがクライアント側のバンドルに含まれ、誰でもブラウザの開発者ツールで閲覧・抽出できる可能性があります。

**現状**: 
- 現在のコードでは`GEMINI_API_KEY`は使用されていません
- ビルド済みファイルにも含まれていません
- しかし、将来的にコードで使用された場合、APIキーが漏洩する危険性があります

**推奨対応**:
- このAPIキーが不要な場合は、`vite.config.ts`から該当設定を削除
- 必要である場合は、APIキーをクライアント側で使用せず、バックエンドサーバー経由で使用する設計に変更

---

## 🟡 中程度の問題

### 2. .gitignoreに環境変数ファイルが含まれていない

**ファイル**: `.gitignore`

**問題**:
- `.env.local`や`.env`ファイルが`.gitignore`に含まれていません
- 環境変数ファイルが誤ってGitリポジトリにコミットされる可能性があります

**推奨対応**:
`.gitignore`に以下を追加:
```
.env
.env.local
.env.*.local
```

### 3. 外部CDNの依存

**ファイル**: `index.html` (11-12, 21-27行目)

**問題**:
- Tailwind CSS CDN (`https://cdn.tailwindcss.com`)
- Google Fonts (`https://fonts.googleapis.com`)
- AI Studio CDN (`https://aistudiocdn.com`)

外部CDNを使用することで、サードパーティのリスク（CDN障害、改ざん、プライバシー問題など）が発生する可能性があります。

**推奨対応**:
- 本番環境では、必要なリソースを自前でホスティングすることを推奨
- または、Subresource Integrity (SRI) ハッシュを使用してCDNの改ざんを検証

### 4. セキュリティヘッダーの欠如

**問題**:
- HTMLにセキュリティヘッダー（Content-Security-Policy、X-Frame-Options等）が設定されていません
- XSSやクリックジャッキング攻撃に対する保護が不十分です

**推奨対応**:
- デプロイ時にWebサーバー（nginx、Apache等）でセキュリティヘッダーを設定
- または、ViteのプラグインでHTMLにメタタグを追加

---

## ✅ 確認済み（問題なし）

### 1. ハードコードされたシークレット
- ✅ コード内にハードコードされたAPIキー、パスワード、トークンは見つかりませんでした

### 2. localStorageの使用
- ✅ localStorageには機密情報ではなく、ユーザーの選択データ（`work_manager_off_days`）のみが保存されています
- ✅ JSON.parseのエラーハンドリングも適切です

### 3. XSS対策
- ✅ Reactの標準的な実装により、自動的にXSS対策が施されています
- ✅ ユーザー入力の直接的なHTML挿入は行われていません

### 4. 依存関係
- ✅ 使用されているパッケージ（react, date-fns, lucide-react）は一般的で信頼性の高いパッケージです

### 5. 認証・認可
- ✅ このアプリケーションは認証機能を持たないため、認証関連の脆弱性は該当しません

---

## 📋 優先度別対応リスト

### 即座に対応すべき項目
1. **vite.config.tsから未使用のAPIキー設定を削除** (問題 #1)

### 早期に対応すべき項目
2. **.gitignoreに環境変数ファイルを追加** (問題 #2)

### 検討すべき項目
3. **外部CDNの見直し** (問題 #3)
4. **セキュリティヘッダーの設定** (問題 #4)

---

## まとめ

現在のコードでは、**実際にAPIキーが漏洩している実害は確認されていません**（コードで使用されていないため）。しかし、`vite.config.ts`に不要なAPIキー設定が残っているため、将来的なリスクを防ぐために削除することを強く推奨します。

その他の問題は、一般的なベストプラクティスの改善項目です。本番環境での運用を継続する場合は、順次対応することをお勧めします。







